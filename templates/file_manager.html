{% extends 'base.html' %}
{% block title %}File Manager{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      {% for crumb in breadcrumbs %}
        <li class="breadcrumb-item {% if loop.last %}active{% endif %}">
          {% if not loop.last %}<a href="{{ url_for('file_manager', path=crumb.path) }}">{{ crumb.name }}</a>{% else %}{{ crumb.name }}{% endif %}
        </li>
      {% endfor %}
    </ol>
  </nav>
  <form class="d-inline" method="post" action="{{ url_for('logout') }}">
    <button type="submit" class="btn btn-outline-danger btn-sm">Logout</button>
  </form>
</div>
<div class="mb-3">
  <form class="d-inline" method="post" enctype="multipart/form-data" action="{{ url_for('upload', path=current_path) }}">
    <input type="file" name="file" required>
    <button type="submit" class="btn btn-primary btn-sm">Upload</button>
  </form>
  {% if is_sudo %}
  <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#createModal">New Folder/File</button>
  {% endif %}
</div>
<table class="table table-hover bg-white">
  <thead>
    <tr><th>Name</th><th>Type</th><th>Actions</th></tr>
  </thead>
  <tbody id="file-list">
    {% for item in items %}
    <tr>
      <td>
        {% if item.is_dir %}
          <a href="{{ url_for('file_manager', path=item.rel_path) }}"><i class="bi bi-folder"></i> {{ item.name }}</a>
        {% else %}
          <i class="bi bi-file-earmark"></i> {{ item.name }}
        {% endif %}
      </td>
      <td>{{ 'Folder' if item.is_dir else 'File' }}</td>
      <td>
        {% if not item.is_dir %}
        <a href="{{ url_for('download', path=item.rel_path) }}" class="btn btn-outline-secondary btn-sm">Download</a>
        {% endif %}
        {% if is_sudo %}
        <button class="btn btn-outline-warning btn-sm rename-btn" data-name="{{ item.name }}" data-path="{{ item.rel_path }}">Rename</button>
        <button class="btn btn-outline-danger btn-sm delete-btn" data-name="{{ item.name }}" data-path="{{ item.rel_path }}">Delete</button>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% if is_sudo %}
<!-- Create Modal -->
<div class="modal fade" id="createModal" tabindex="-1" aria-labelledby="createModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="createForm">
        <div class="modal-header">
          <h5 class="modal-title" id="createModalLabel">Create New</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="path" value="{{ current_path }}">
          <div class="mb-3">
            <label for="name" class="form-label">Name</label>
            <input type="text" class="form-control" id="name" name="name" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Type</label>
            <select class="form-select" name="type">
              <option value="folder">Folder</option>
              <option value="file">File</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success">Create</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endif %}
<!-- Modals for create/rename/delete will be handled by JS -->
{% endblock %} 